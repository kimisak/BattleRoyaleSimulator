# Battle Royale Simulator

## Developing

Once you've created a project and installed dependencies with `pnpm install` (or `npm install` or `yarn`), start a development server:

```bash
pnpm run dev
# or start the server and open the app in a new browser tab
pnpm run dev -- --open
```

## Building

To create a production version of your app:

```bash
pnpm run build
```

You can preview the production build with `pnpm run preview`.

> To deploy your app, you may need to install an [adapter](https://kit.svelte.dev/docs/adapters) for your target environment.

# Documentation

## Placeholders, Regexes, Genders, and Pronouns

### A contentful GameEvent.text

`type` [GameEvent](./src/lib/types/game.types.ts) has a `text`, which describes what happens in the simulator.
This text may include placeholders for players and their pronouns, such as `(Player#)` and `(Pronouns#)`, which I refer to as the whole pronoun placeholder, including `dividers`.

For example:

> `(Player1)` discovered `(Player2)` and `(Player3)` conspiring against `(him/her/them1)`. `(he/she/they1)` fought back and eliminated `(Player2)` and `(Player3)`.

The player and pronoun placeholders are indexed and should correspond. If `(Player1)` was a `female` named `Katniss`, the `Pronouns` in the sentence would be `her` and `she`.

### Replacement of Placeholders

There are multiple [helpers](./src/lib/helper.ts) that are responsible for the replacements of placeholders.

- `replaceTextPlaceholders(text, players)` works as the `main` of placeholder replacements where
- `(Player#)` placeholders are replaced with `replacePlayerNamePlaceholders(text, players)`.
- `(Pronouns#)` placeholders are replaced with `replaceMultiplePronounTypePlaceholders(text, players)` which
- finds all pronoun types with `getPronounsInText(text)` used in the `text` and iterates through them, calling `replaceSingularPronounTypePlaceholders(text, players, regex, divider)` to replace each pronoun type match with the corresponding player's pronoun.

In short:

```
replaceTextPlaceholders(...)
|-- replacePlayerNamePlaceholders(...)
|-- replaceMultiplePronounTypePlaceholders(...)
|   |-- getPronounsInText(...)
|   |-- replaceSingularPronounTypePlaceholders(...)
|---|
|
returns text with player names and pronouns instead of placeholders.
```

### Regexes

Regexes are used to replace the placeholders within the functions above.
The regexes are stored in [./src/lib/constants](./src/lib/constants.ts) and are generated by the [helper](./src/lib/helper.ts) `generatePronounRegExpStrings(GENDERS)`.
These three constants define the regex rules:

1. `GAME_EVENT_TEXT_PLAYER_REGEX` decides how to capture the player placeholders.
2. `GAME_EVENT_TEXT_PRONOUN_DYNAMIC_REGEX` decides how to capture the player pronoun placeholders. It is used in `generatePronounRegExpStrings(...)` to generate the capture groups for all pronoun type values for all genders, divided by the next constant,
3. `GAME_EVENT_TEXT_PRONOUN_DIVIDER`, which divides the pronoun type values for all genders in the same helper, `generatePronounRegExpStrings(...)`.

I insist you keep the placeholder format as is, and only change the `GAME_EVENT_TEXT_PRONOUN_DIVIDER`. However, if the format of the player or pronoun placeholders used in `GameEvent.text` changes, these regexes must reflect that change and be updated.

The point of this intricate solution to replace placeholders by dynamically and automatically creating regexes based on these constants, and the gender and pronoun constants, will hopefully be clear in the following section.

### Genders and Pronouns
